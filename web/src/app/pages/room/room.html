<div class="container mx-auto px-4 sm:px-6 lg:px-8 max-w-6xl">
  <!-- Players -->
  @if (room) {
    <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4 mb-4">
      @for (player of room.players; track player.id) {
        <app-player-card [player]="player"></app-player-card>
      }
    </div>
  }

  @if (room.state == "lobby") {
    <div class="bg-gray-800 p-4 rounded-lg">
      <h2 class="text-white text-lg font-medium mb-2">
        Lobby - Room Code ({{ room.code }})
      </h2>
      <p class="text-gray-400">Waiting for players to join...</p>
    </div>

    @if (room.owner == playerId) {
      <div class="mt-4">
        <button
          class="w-full bg-primary hover:bg-primary-700 disabled:bg-gray-600 disabled:cursor-not-allowed text-black py-3 px-4 rounded-lg font-medium disabled:text-white transition-colors"
          [disabled]="room.players.length < 2"
          (click)="onGameStart()"
        >
          Start Game
        </button>
      </div>
    }
  }

  @if (room.state == "in_progress") {
    <div class="bg-gray-800 p-4 rounded-lg mb-4">
      <h2 class="text-white text-lg font-medium mb-2">Game in Progress</h2>
      <p class="text-gray-400">
        Current round: {{ currentRound }}/{{ room.rounds }}
      </p>
    </div>

    <!-- Character Guess Input -->
    <div class="bg-gray-800 p-4 rounded-lg">
      <h3 class="text-white text-md font-medium mb-3">Guess the Character</h3>

      <div class="autocomplete-container">
        <input
          type="text"
          [(ngModel)]="guessInput"
          (input)="onGuessInputChange()"
          (keydown)="onKeyDown($event)"
          placeholder="Type a character name..."
          class="w-full px-3 py-2 bg-gray-700 text-white border rounded-lg focus:outline-none focus:ring-1 transition-colors"
          [class.border-gray-600]="!selectedCharacterId"
          [class.border-green-500]="selectedCharacterId"
          [class.focus:border-primary]="!selectedCharacterId"
          [class.focus:ring-primary]="!selectedCharacterId"
          [class.focus:border-green-400]="selectedCharacterId"
          [class.focus:ring-green-400]="selectedCharacterId"
          autocomplete="off"
        />

        <!-- Autocomplete Suggestions -->
        @if (showSuggestions) {
          <div class="suggestions-dropdown">
            @for (
              character of filteredCharacters;
              track character.id;
              let i = $index
            ) {
              <div
                class="suggestion-item"
                [class.bg-gray-600]="selectedSuggestionIndex === i"
                (click)="selectCharacter(character)"
              >
                {{ character.name }}
              </div>
            }
          </div>
        }
      </div>

      <button
        (click)="submitGuess()"
        [disabled]="!guessInput.trim()"
        class="mt-3 w-full py-2 px-4 rounded-lg font-medium transition-colors"
        [class.bg-primary]="selectedCharacterId"
        [class.hover:bg-primary-700]="selectedCharacterId"
        [class.text-black]="selectedCharacterId"
        [class.bg-yellow-600]="!selectedCharacterId && guessInput.trim()"
        [class.hover:bg-yellow-700]="!selectedCharacterId && guessInput.trim()"
        [class.text-white]="!selectedCharacterId && guessInput.trim()"
        [class.bg-gray-600]="!guessInput.trim()"
        [class.cursor-not-allowed]="!guessInput.trim()"
        [class.text-white]="!guessInput.trim()"
      >
        @if (!guessInput.trim()) {
          Submit Guess
        } @else if (selectedCharacterId) {
          Submit Guess âœ“
        } @else {
          Submit Guess (Not in list)
        }
      </button>
    </div>
  }
</div>
